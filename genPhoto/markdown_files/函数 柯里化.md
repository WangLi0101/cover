### 定义

在数学和计算机科学中，柯里化是一种将使用多个参数的一个函数转换成一系列使用一个参数的函数的技术。

### 应用场景

- 正则检验的需求

比如校验电话号码、校验邮箱、校验身份证号、校验密码等， 这时我们会封装一个通用函数 `checkByRegExp` ,接收两个参数，校验的正则对象和待校验的字符串

```javascript
function checkByRegExp(regExp,string) {
    return regExp.test(string);  
}

checkByRegExp(/^1\d{10}$/, '18642838455'); // 校验电话号码
checkByRegExp(/^(\w)+(\.\w+)*@(\w)+((\.\w+)+)$/, 'test@163.com'); // 校验邮箱
```

这么写不方便，此时，我们可以借助柯里化对 `checkByRegExp` 函数进行封装，以简化代码书写，提高代码可读性。

```javascript
//进行柯里化
let _check = curry(checkByRegExp);
//生成工具函数，验证电话号码
let checkCellPhone = _check(/^1\d{10}$/);
//生成工具函数，验证邮箱
let checkEmail = _check(/^(\w)+(\.\w+)*@(\w)+((\.\w+)+)$/);

checkCellPhone('18642838455'); // 校验电话号码
checkCellPhone('13109840560'); // 校验电话号码
checkCellPhone('13204061212'); // 校验电话号码

checkEmail('test@163.com'); // 校验邮箱
checkEmail('test@qq.com'); // 校验邮箱
checkEmail('test@gmail.com'); // 校验邮箱
```

> 柯里化的这种用途可以被理解为：**参数复用**

- 假定我们有这样一段数据：

```javascript
let list = [
    {
        name:'lucy'
    },
    {
        name:'jack'
    }
]
```

我们需要获取数据中的所有 name 属性的值，常规思路下，我们会这样实现:

```javascript
let names = list.map(function(item) {
  return item.name;
})
```

那么我们如何用柯里化的思维来实现呢

```javascript
let prop = curry(function(key,obj) {
    return obj[key];
})
let names = list.map(prop('name'))
// 等同于
let names2 = list.map((obj) => prop('name')(obj))
```

通过柯里化的方式，我们的代码是不是变得更精简了，并且可读性更高了呢。

- `ajax` 封装

```javascript
function ajax(type, url, data) {    
	var xhr = new XMLHttpRequest();    
	xhr.open(type, url, true);    
	xhr.send(data);
}
// 虽然 ajax 这个函数非常通用，但在重复调用的时候参数冗余
ajax('POST', 'www.test.com', "name=kevin")
ajax('POST', 'www.test2.com', "name=kevin")
ajax('POST', 'www.test3.com', "name=kevin")
// 利用 curry
var ajaxCurry = curry(ajax);
// 以 POST 类型请求数据
var post = ajaxCurry('POST');
post('www.test.com', "name=kevin");
// 以 POST 类型请求来自于 www.test.com 的数据
var postFromTest = post('www.test.com');
postFromTest("name=kevin");
```

- 事件处理

```javascript
const handleEvent = curry(function(eventType, handler, element) {
  element.addEventListener(eventType, handler);
});

const handleClick = handleEvent('click');
handleClick(() => alert('Clicked!'), document.getElementById('myButton'));
```

- 条件逻辑

```javascript
const ifElse = curry((condition, ifTrue, ifFalse, value) =>
  condition(value) ? ifTrue(value) : ifFalse(value)
);

const isPositive = x => x > 0;
const logPositive = x => console.log(`${x} is positive`);
const logNegative = x => console.log(`${x} is negative or zero`);

const checkNumber = ifElse(isPositive, logPositive, logNegative);
checkNumber(10); // 输出: 10 is positive
checkNumber(-5); // 输出: -5 is negative or zero
```

- 日志记录/调试

```javascript
const log = curry(function(level, message) {
  console[level](message);
});

const logError = log('error');
logError('This is an error!'); // 输出: This is an error!

const logInfo = log('info');
logInfo('This is an info message!'); // 输出: This is an info message!
```

### 实现

```javascript
// 占位符符号，允许在柯里化时跳过某些参数
const _ = Symbol('placeholder');

/**
 * 将函数柯里化
 * @param fn    待柯里化的原函数
 * @param len   所需的参数个数，默认为原函数的形参个数
 */
function curry(fn, len = fn.length) {
    if (typeof fn !== 'function') {
        throw new TypeError('Expected a function');
    }
    return _curry.call(this, fn, len);
}

/**
 * 中转函数
 * @param fn    待柯里化的原函数
 * @param len   所需的参数个数
 * @param args  已接收的参数列表
 */
function _curry(fn, len, args = []) {
    return (...params) => {
        // 合并参数并处理占位符
        // 如果当前元素 a 是占位符 _，并且新接收的参数 params 数组中还有参数可以使用，那么就用 params.shift() 来替换这个占位符。
        // params.shift() 会返回数组 params 的第一个元素，同时修改 params 的值，将第一个元素从数组中删除。
        // 在 map 操作过程中，params.shift() 会逐步移除 params 数组中的元素，因此 concat(params) 只会添加那些没有被移除的参数。
        const combined = args.map(a => a === _ && params.length ? params.shift() : a).concat(params);

        // 过滤掉占位符，检查参数长度
        // 如果 _ 的个数大于 params 的个数，说明 combined 中还有占位符没有被替换
        const validArgs = combined.filter(a => a !== _);

        if (validArgs.length >= len) {
            return fn.apply(this, combined);
        } else {
            return _curry.call(this, fn, len, combined);
        }
    };
}
```